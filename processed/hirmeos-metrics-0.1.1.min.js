var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],r=!0,n=!1,i=void 0;try{for(var l,s=e[Symbol.iterator]();!(r=(l=s.next()).done)&&(a.push(l.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var supportedLocales=["en","fr","de","it","es","pt","el"],widgetLocale={widgetTitle:{en:"Metrics",fr:"Statistiques",de:"Statistiken",it:"Statistiche",es:"",pt:"",el:"Στατιστικά"},detailsLink:{en:"measures available",fr:"indicateurs disponibles",de:"Metriken vorhanden",it:"misure disponibili",es:"",pt:"",el:"Τύποι στατιστικών διαθέσιμοι"},dataType:{en:"Measures",fr:"Indicateurs",de:"Metriken",it:"Misure",es:"",pt:"",el:"Τύποι στατιστικών"},tableHeaderNumber:{en:"Value",fr:"Nombre",de:"Wert",it:"Quantità",es:"",pt:"",el:"Τιμή"},tableHeaderType:{en:"Type",fr:"Type",de:"Typ",it:"Tipo",es:"",pt:"",el:"Τύπος"},tableHeaderSource:{en:"Source",fr:"Source",de:"Quelle",it:"Provenienza",es:"",pt:"",el:"Πηγή"},viewDetails:{en:"Show details",fr:"Voir détails",de:"Details anzeigen",it:"Vedi",es:"",pt:"",el:"Προβολή λεπτομερειών"},hideDetails:{en:"Hide details",fr:"Masquer détails",de:"Details ausblenden",it:"Nascondi",es:"",pt:"",el:"Απόκρυψη λεπτομερειών"},hoverLinkMeasureDefinition:{en:"Click to see definition",fr:"Cliquez pour voir la définition",de:"Klicken Sie hier, um die Definition zu sehen",it:"Clicca per vedere la definizione",es:"",pt:"",el:"Κάντε κλικ για να δείτε τον ορισμό"}};function setDefault(e,t){return void 0===e?t:e}function setLocale(e){var t=setDefault(e.split("_")[0],"en");return supportedLocales.includes(t)||(console.log("Cannot recognise language code "+t),t="en"),t}function getLocale(e){var t=widgetLocale[e][localeLanguage];return void 0!==t&&0!==t.length||console.log("No locale value for "+e+" "+localeLanguage),t}function setMeasuresDict(e){var t={};return e.forEach(function(e){t[e.measure_uri]={source:e.source,type:e.type}}),t}function getMeasureInfo(){return fetch(measureUrl).then(function(e){return e.json()}).then(function(e){return e.data}).then(function(e){measure_data=setMeasuresDict(e)})}function fetchMetricsData(e,t){return fetch(e,t).then(function(e){return e.json()}).then(function(e){glob_data=e.data})}function fetchAPIData(e,t){return Promise.all([getMeasureInfo(),fetchMetricsData(e,t)])}function getMetrics(){var e={};return glob_data.forEach(function(t){e[t.measure_uri]?e[t.measure_uri]+=t.value:e[t.measure_uri]=t.value}),e}var ExternalLink=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"metrics-dashbord-link"},React.createElement("a",{className:"btn btn-dark metrics-dashbord-link",href:this.props.detailedMetricsLink},"View detailed metrics dashboard"))}}]),t}(),WidgetMain=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={showMetrics:!1},a}return _inherits(t,React.Component),_createClass(t,[{key:"handleClick",value:function(){this.setState({showMetrics:!this.state.showMetrics})}},{key:"render",value:function(){var e=this;return React.createElement("div",{className:"hirmeos-widget"},React.createElement("div",{className:"metrics-pre-expand"},React.createElement("div",{className:"metrics-count-container"},React.createElement("button",{className:"metrics-widget-btn",onClick:function(){return e.handleClick()}},this.props.totalMetrics),React.createElement("p",{className:"button-measure-text"},getLocale("detailsLink"))),React.createElement("div",{className:"metrics-details-container"},React.createElement("h3",{className:"metrics-title"},void 0===widgetTitle?getLocale("widgetTitle"):widgetTitle),React.createElement("button",{className:"btn btn-link",onClick:function(){return e.handleClick()}},this.state.showMetrics?getLocale("hideDetails"):getLocale("viewDetails")))),this.state.showMetrics?this.props.innerContent:null,this.props.showLink?React.createElement(ExternalLink,{detailedMetricsLink:detailedMetricsLink,detailedMetricsText:detailedMetricsText}):null)}}]),t}(),WidgetTableRow=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,React.Component),_createClass(t,[{key:"handleClick",value:function(){window.open(this.props.values[0],"_blank")}},{key:"render",value:function(){var e=this;return React.createElement("tr",{className:"table-row-body",onClick:function(){return e.handleClick()},title:getLocale("hoverLinkMeasureDefinition")},React.createElement("td",null,measure_data[this.props.values[0]].source),React.createElement("td",null,measure_data[this.props.values[0]].type),React.createElement("td",{className:"textAlignCenter"},this.props.values[1]))}}]),t}(),App=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=getMetrics();if(0===Object.entries(e).length&&e.constructor===Object)return console.log("No metrics available for this entry."),React.createElement("span",{hidden:!0});var t=[],a=!0,r=!1,n=void 0;try{for(var i,l=Object.entries(e)[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var s=i.value,c=_slicedToArray(s,2),o=c[0],u=c[1];0!==u&&t.push([o,u])}}catch(e){r=!0,n=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw n}}var d=t.length,f=t.map(function(e,t){return React.createElement(WidgetTableRow,{key:t,values:e})}),p=React.createElement("div",{className:"post-expand"},React.createElement("table",{className:"table table-insert"},React.createElement("thead",null,React.createElement("tr",{className:"table-row-head"},React.createElement("th",null,getLocale("tableHeaderSource")),React.createElement("th",null,getLocale("tableHeaderType")),React.createElement("th",{className:"textAlignCenter"},getLocale("tableHeaderNumber")))),React.createElement("tbody",null,f)));return React.createElement("div",{className:"hirmeos-widget"},React.createElement("div",null,React.createElement(WidgetMain,{innerContent:p,totalMetrics:d,showLink:showDetailedMetricsLink})))}}]),t}(),base_url=new URL(setDefault(widget_params.baseUrl,"https://metrics.ubiquity.press")),url=new URL(base_url+"events"),measureUrl=new URL(base_url+"measures"),measure_data=void 0;url.searchParams.append("filter","work_uri:"+widget_params.uri);var showDetailedMetricsLink=setDefault(widget_params.showDetailedMetricsLink,!1),detailedMetricsLink=setDefault(widget_params.detailedMetricsLink,"#NotImplemented"),detailedMetricsText=setDefault(widget_params.detailedMetricsText,"View detailed metrics dashboard"),localeSetting=setDefault(widget_params.locale,"en"),localeLanguage=setLocale(localeSetting),glob_data=[],widgetTitle=widget_params.widgetTitle,params={method:"GET"};fetchAPIData(url,params).then(function(){var e=document.querySelector("#metrics-block");ReactDOM.render(React.createElement(App,null),e)});