var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],a=!0,n=!1,i=void 0;try{for(var s,c=e[Symbol.iterator]();!(a=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&c.return&&c.return()}finally{if(n)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function getMetrics(){var e={};return glob_data.forEach(function(t){e[t.measure_uri]?e[t.measure_uri]+=t.value:e[t.measure_uri]=t.value}),e}var ExternalLink=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"metrics-dashbord-link"},React.createElement("a",{className:"btn btn-dark metrics-dashbord-link",href:this.props.detailedMetricsLink},"View detailed metrics dashboard"))}}]),t}(),WidgetMain=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={showMetrics:!1},r}return _inherits(t,React.Component),_createClass(t,[{key:"handleClick",value:function(){this.setState({showMetrics:!this.state.showMetrics})}},{key:"render",value:function(){var e=this;return React.createElement("div",{className:"hirmeos-widget"},React.createElement("div",{className:"metrics-pre-expand"},React.createElement("div",{className:"metrics-count-container"},React.createElement("button",{className:"metrics-widget-btn",onClick:function(){return e.handleClick()}},this.props.totalMetrics),React.createElement("p",{className:"button-measure-text"},"Measures")),React.createElement("div",{className:"metrics-details-container"},React.createElement("h3",{className:"metrics-title"},void 0===widgetTitle?"Metrics":widgetTitle),React.createElement("button",{className:"btn btn-link",onClick:function(){return e.handleClick()}},this.props.totalMetrics," measures are available"))),this.state.showMetrics?this.props.innerContent:null,this.props.showLink?React.createElement(ExternalLink,{detailedMetricsLink:detailedMetricsLink,detailedMetricsText:detailedMetricsText}):null)}}]),t}(),App=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=getMetrics(),t=[],r=!0,a=!1,n=void 0;try{for(var i,s=Object.entries(e)[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value,l=_slicedToArray(c,2),o=l[0],u=l[1];0!==u&&t.push([o,u])}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}var d=t.length,m=t.map(function(e,t){return React.createElement("tr",{key:t,className:"table-row-body"},React.createElement("td",null,e[0]),React.createElement("td",{className:"textAlignCenter"},e[1]))}),h=React.createElement("div",{className:"post-expand"},React.createElement("table",{className:"table table-insert"},React.createElement("thead",null,React.createElement("tr",{className:"table-row-head"},React.createElement("th",null,"Measure"),React.createElement("th",{className:"textAlignCenter"},"Value"))),React.createElement("tbody",null,m)));return React.createElement("div",{className:"hirmeos-widget"},React.createElement("div",null,React.createElement(WidgetMain,{innerContent:h,totalMetrics:d,showLink:showDetailedMetricsLink})))}}]),t}();function setDefault(e,t){return void 0===e?t:e}var url=new URL(setDefault(widget_params.baseUrl,"https://metrics.ubiquity.press/events"));url.searchParams.append("filter","work_uri:"+widget_params.uri);var showDetailedMetricsLink=setDefault(widget_params.showDetailedMetricsLink,!1),detailedMetricsLink=setDefault(widget_params.detailedMetricsLink,"#NotImplemented"),detailedMetricsText=setDefault(widget_params.detailedMetricsText,"View detailed metrics dashboard"),glob_data=[],widgetTitle=widget_params.widgetTitle,params={method:"GET"};fetch(url,params).then(function(e){return e.json()}).then(function(e){glob_data=e.data}).then(function(){var e=document.querySelector("#metrics-block");ReactDOM.render(React.createElement(App,null),e)});